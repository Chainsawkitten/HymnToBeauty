<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hymn to Beauty: Player Input</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Hymn to Beauty
   </div>
   <div id="projectbrief">C++ 3D Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_your_first_hymn__player_input.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Player Input </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>You now have a camera entity that moves to the right through script. But to actually let the player control it, you need to handle player input.</p>
<h1><a class="anchor" id="MousePosition"></a>
Mouse position</h1>
<p>The global function <code>vec2 GetCursorXY()</code> returns the mouse's current position. By comparing this to the previous frame's position we can implement mouse looking.</p>
<p>Add a member variable to store the position from the previous frame. </p><pre class="fragment">vec2 mousePosition;
</pre><p> Then in the <code>Update</code> method we can get the difference compared to the previous frame, and then update the previous position for next frame. </p><pre class="fragment">// Get mouse position compared to previous frame's.
vec2 newPosition = GetCursorXY();
vec2 mouseDiff = newPosition - mousePosition;
mousePosition = newPosition;
</pre><p> Using the mouse movement, let's change the rotation of the camera. First we need to store the rotation of the camera. We will only consider yaw (horizontal movement) and pitch (vertical movement) and ignore roll. </p><pre class="fragment">float yaw = 0.0f;
float pitch = 0.0f;
</pre><p> Now in the <code>Update</code> method we can update these based on the <code>mouseDiff</code>. </p><pre class="fragment">yaw -= mouseDiff.x;
pitch -= mouseDiff.y;
</pre><p> Adding a full radian for every pixel the mouse moves is a lot. This will make the camera uncontrollable, so let's consider mouse sensitivity. Add another member variable: </p><pre class="fragment">float mouseSensitivity = 0.01f;
</pre><p> Then scale the yaw and pitch changes based on the sensitivity. </p><pre class="fragment">yaw -= mouseDiff.x * mouseSensitivity;
pitch -= mouseDiff.y * mouseSensitivity;
</pre><p> You now have the desired yaw and pitch. The only thing left to do is to set the entity's rotation based on these values. However, Hymn to Beauty uses quaternions, not Euler angles. To set the rotation, we first need to convert these Euler angles to quaternions. </p><pre class="fragment">// Calculate quaternion from Euler angles.
vec3 yawAxis = vec3(0.0f, 1.0f, 0.0f);
yawAxis *= sin(yaw * 0.5f);
quat yawRotation = quat(cos(yaw * 0.5f), yawAxis.x, yawAxis.y, yawAxis.z);

vec3 pitchAxis = vec3(1.0f, 0.0f, 0.0f);
pitchAxis *= sin(pitch * 0.5f);
quat pitchRotation = quat(cos(pitch * 0.5f), pitchAxis.x, pitchAxis.y, pitchAxis.z);

self.rotation = yawRotation * pitchRotation;
</pre><p> The final code looks like this. </p><pre class="fragment">class FirstPersonController {
    Entity @self;
    vec2 mousePosition;
    float mouseSensitivity = 0.01f;
    float yaw = 0.0f;
    float pitch = 0.0f;

    FirstPersonController(Entity @entity){
        @self = @entity;

        mousePosition = GetCursorXY();

        // Remove this if updates are not desired.
        RegisterUpdate();
    }

    // Called by the engine for each frame.
    void Update(float deltaTime) {
        // Get mouse position compared to previous frame's.
        vec2 newPosition = GetCursorXY();
        vec2 mouseDiff = newPosition - mousePosition;
        mousePosition = newPosition;

        // Mouse look.
        yaw -= mouseDiff.x * mouseSensitivity;
        pitch -= mouseDiff.y * mouseSensitivity;

        // Calculate quaternion from Euler angles.
        vec3 yawAxis = vec3(0.0f, 1.0f, 0.0f);
        yawAxis *= sin(yaw * 0.5f);
        quat yawRotation = quat(cos(yaw * 0.5f), yawAxis.x, yawAxis.y, yawAxis.z);

        vec3 pitchAxis = vec3(1.0f, 0.0f, 0.0f);
        pitchAxis *= sin(pitch * 0.5f);
        quat pitchRotation = quat(cos(pitch * 0.5f), pitchAxis.x, pitchAxis.y, pitchAxis.z);

        self.rotation = yawRotation * pitchRotation;
    }
}
</pre><p> Try it out by playing the hymn and looking around by moving your mouse.</p>
<h1><a class="anchor" id="ButtonInput"></a>
Button input</h1>
<p>Next you'll implement standard WASD movement. But rather than checking if the W key has been pressed in order to move forward, you'll define a "forward" button, and assign that to W. The advantage of this approach is that the keys can be reassigned, for instance if you're using an AZERTY keyboard you can assign the forward button to Z instead, without having to change any of your scripts.</p>
<h2>Defining an input</h2>
<p>Press on <code>Hymn</code> and select <code>Input</code>.</p>
<div class="image">
<img src="HymnInput.png" alt=""/>
</div>
<p>This brings up the Input window.</p>
<div class="image">
<img src="InputWindow.png" alt=""/>
</div>
<p>This is the window you use to define all the inputs for your hymn. To add a new button, click on <code>Add Button</code>.</p>
<p>You will need to define three things:</p>
<ol type="1">
<li>The name of the action. This name has to be unique and is what you will use in scripts.</li>
<li>The key assigned to the action. See the list of values <a href="https://www.glfw.org/docs/3.3/group__keys.html">here</a>.</li>
<li>The state the key should be in to trigger the action. 0 means the key is released. 1 means the key is pressed. 2 means the key is repeated.</li>
</ol>
<div class="image">
<img src="WASD.png" alt=""/>
</div>
<h2>Checking button input in script</h2>
<p>We can check for button inputs using the <code>bool Input(input)</code> function.</p>
<p>Begin by defining a member variable for the movement speed. </p><pre class="fragment">float movementSpeed = 2.0f;
</pre><p> Next, at the end of the <code>Update</code> method, figure out what directions we should move in when WASD are pressed. </p><pre class="fragment">// Calculate forward and right vectors.
float forwardAngle = yaw + radians(90);
vec3 forwardDir = vec3(cos(forwardAngle), 0.0, sin(-forwardAngle));
float rightAngle = yaw;
vec3 rightDir = vec3(cos(rightAngle), 0.0, sin(-rightAngle));
</pre><p> Query the input: </p><pre class="fragment">// Get WASD movement.
float forwardMovement = (Input(forward) ? 1.0f : 0.0f) - (Input(backward) ? 1.0f : 0.0f);
float rightMovement = (Input(right) ? 1.0f : 0.0f) - (Input(left) ? 1.0f : 0.0f);
</pre><p> Angelscript does not allow casting between <code>bool</code> and <code>float</code> so use inline <code>if</code>s to do the casting.</p>
<p>Finally, perform the movement. </p><pre class="fragment">// Move.
self.position += forwardDir * forwardMovement * movementSpeed * deltaTime;
self.position += rightDir * rightMovement * movementSpeed * deltaTime;
</pre><p> You have now implemented standard first person movement. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="_getting_started.html">Getting Started</a></li><li class="navelem"><a class="el" href="_your_first_hymn.html">Your First Hymn</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
